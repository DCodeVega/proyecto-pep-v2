{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <!-- Encabezado -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">üí∞ Flujos de Caja</h2>
            {% if proyecto %}
            <div>
                <span class="badge bg-primary">Proyecto: {{ proyecto.nombre }}</span>
                <!-- <span class="badge bg-success">Producto: {{ proyecto.nombre_producto }}</span> -->
            </div>
            {% endif %}
        </div>

        <!-- Informaci√≥n del Excel -->
        <div class="alert alert-info mb-4">
            <h5 class="alert-heading">‚ÑπÔ∏è Descripcion:</h5>
            <p class="mb-0">En esta de <strong>"Flujos de caja"</strong> calcularemos:
                Las definiciones de las ventas por periodo y se calculan autom√°ticamente los ingresos, costos, gastos,
                egresos y utilidad bruta.</p>
        </div>

        <!-- Advertencia si no hay proyecto -->
        {% if not proyecto %}
        <div class="alert alert-warning">
            <h5>‚ö†Ô∏è Primero debes crear un proyecto</h5>
            <p>Para configurar flujos de caja, primero necesitas crear un proyecto en la secci√≥n "Datos Iniciales".</p>
            <a href="{{ url_for('datos_iniciales') }}" class="btn btn-warning">Ir a Datos Iniciales ‚Üí</a>
        </div>
        {% else %}

        <!-- Selector de tipo de flujo -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-purple text-white">
                <h5 class="mb-0">‚è∞ Elegir Periodo de An√°lisis</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-light mb-4">
                    <p class="mb-0">
                        <strong>‚ö†Ô∏è Nota:</strong> Estos flujos de abajo cambiar√°n seg√∫n el tipo de flujo escogido
                        anteriormente.
                    </p>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <label class="form-label"><strong>elegir opcion:</strong></label>
                        <div class="d-flex flex-wrap gap-3 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo_flujo" id="flujo_dias"
                                    value="dias" onclick="mostrarFlujo('dias')" {% if request.args.get('tipo')
                                    !='semanas' and request.args.get('tipo') !='meses' and request.args.get('tipo')
                                    !='anos' %}checked{% endif %}>
                                <label class="form-check-label" for="flujo_dias">
                                    flujo por dias
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo_flujo" id="flujo_semanas"
                                    value="semanas" onclick="mostrarFlujo('semanas')" {% if
                                    request.args.get('tipo')=='semanas' %}checked{% endif %}>
                                <label class="form-check-label" for="flujo_semanas">
                                    flujo por semanas
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo_flujo" id="flujo_meses"
                                    value="meses" onclick="mostrarFlujo('meses')" {% if
                                    request.args.get('tipo')=='meses' %}checked{% endif %}>
                                <label class="form-check-label" for="flujo_meses">
                                    flujo por meses
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo_flujo" id="flujo_anos"
                                    value="anos" onclick="mostrarFlujo('anos')" {% if request.args.get('tipo')=='anos'
                                    %}checked{% endif %}>
                                <label class="form-check-label" for="flujo_anos">
                                    flujo por a√±os
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumen de datos previos -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">üìä DATOS PREVIOS</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Datos del proyecto -->
                    <div class="col-md-4">
                        <table class="table table-bordered">
                            <tr>
                                <th>PROYECTO:</th>
                                <td>{{ proyecto.nombre }}</td>
                            </tr>
                            <tr>
                                <th>Actividad:</th>
                                <td>{{ proyecto.tipo_actividad }}</td>
                            </tr>
                            <tr>
                                <th>Inversi√≥n:</th>
                                <td>{{ 'S√≠' if proyecto.tiene_inversion == 1 else 'No' }}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-4">
                        <table class="table table-bordered">
                            <tr>
                                <th>Tasa:</th>
                                <td>{{ (proyecto.tasa_descuento * 100)|round(3) }}%</td>
                            </tr>
                            <tr>
                                <th>Producto en Total:</th>
                                <td>{{ contar_productos() }}</td>
                            </tr>
                            <tr>
                                <th>Valor Inversion:</th>
                                <td>Bs {{ proyecto.valor_inversion|round(2) }}</td>
                            </tr>
                        </table>
                    </div>

                    <!-- Totales acumulados -->
                    <div class="col-md-4">
                        <div class="card bg-light h-100">
                            <div class="card-body">
                                <h6 class="card-title text-center mb-3">TOTALES ACUMULADOS</h6>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Costos de Productos:</span>
                                    <strong class="text-success">Bs {{ totales.costos_productos|round(2) }}</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Costos Generales:</span>
                                    <strong class="text-success">Bs {{ totales.costos_generales|round(2) }}</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Gastos:</span>
                                    <strong class="text-warning">Bs {{ totales.gastos|round(2) }}</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Salarios:</span>
                                    <strong class="text-danger">Bs {{ totales.salarios|round(2) }}</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Materiales:</span>
                                    <strong class="text-info">Bs {{ totales.materiales|round(2) }}</strong>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <strong>Total General:</strong>
                                    <strong>Bs {{ (totales.costos_productos + totales.costos_generales + totales.gastos
                                        + totales.salarios + totales.materiales)|round(2) }}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== FLUJO POR D√çAS ========== -->
        <div id="flujo_dias_container" class="flujo-container">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üìÖ Flujo por D√≠as</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('guardar_ventas_dias') }}">
                        <div class="table-responsive">
                            <table class="table table-bordered text-center">
                                <thead class="table-light">
                                    <tr>
                                        <th>flujo por dias</th>
                                        <th>lunes</th>
                                        <th>martes</th>
                                        <th>mi√©rcoles</th>
                                        <th>jueves</th>
                                        <th>viernes</th>
                                        <th>s√°bado</th>
                                        <th>domingo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="table-secondary"><strong>Nro de productos vendidos</strong></td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="lunes"
                                                value="{{ ventas_dias.lunes if ventas_dias else 4 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="martes"
                                                value="{{ ventas_dias.martes if ventas_dias else 3 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="miercoles"
                                                value="{{ ventas_dias.miercoles if ventas_dias else 2 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="jueves"
                                                value="{{ ventas_dias.jueves if ventas_dias else 4 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="viernes"
                                                value="{{ ventas_dias.viernes if ventas_dias else 6 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="sabado"
                                                value="{{ ventas_dias.sabado if ventas_dias else 10 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="domingo"
                                                value="{{ ventas_dias.domingo if ventas_dias else 4 }}" min="0">
                                        </td>
                                    </tr>

                                    <!-- C√°lculos autom√°ticos -->
                                    <!-- C√°lculos autom√°ticos -->
                                    {% if ventas_dias and ingresos_dias %}
                                    <tr class="table-success">
                                        <td><strong>Ingresos</strong></td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="ingresos_lunes"
                                                value="{{ ingresos_dias.lunes if ingresos_dias else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="ingresos_martes"
                                                value="{{ ingresos_dias.martes if ingresos_dias else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center"
                                                name="ingresos_miercoles"
                                                value="{{ ingresos_dias.miercoles if ingresos_dias else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="ingresos_jueves"
                                                value="{{ ingresos_dias.jueves if ingresos_dias else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center"
                                                name="ingresos_viernes"
                                                value="{{ ingresos_dias.viernes if ingresos_dias else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="ingresos_sabado"
                                                value="{{ ingresos_dias.sabado if ingresos_dias else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center"
                                                name="ingresos_domingo"
                                                value="{{ ingresos_dias.domingo if ingresos_dias else 0 }}" min="0">
                                        </td>
                                    </tr>
                                    <tr class="table-danger">
                                        <td><strong>Costos (diarios)</strong></td>
                                        <td>Bs {{ (ventas_dias.lunes * totales.costos_generales if ventas_dias else
                                            0)|round(2) }}</td>
                                        <td>Bs {{ (ventas_dias.martes * totales.costos_generales if ventas_dias else
                                            0)|round(2) }}</td>
                                        <td>Bs {{ (ventas_dias.miercoles * totales.costos_generales if ventas_dias else
                                            0)|round(2) }}</td>
                                        <td>Bs {{ (ventas_dias.jueves * totales.costos_generales if ventas_dias else
                                            0)|round(2) }}</td>
                                        <td>Bs {{ (ventas_dias.viernes * totales.costos_generales if ventas_dias else
                                            0)|round(2) }}</td>
                                        <td>Bs {{ (ventas_dias.sabado * totales.costos_generales if ventas_dias else
                                            0)|round(2) }}</td>
                                        <td>Bs {{ (ventas_dias.domingo * totales.costos_generales if ventas_dias else
                                            0)|round(2) }}</td>
                                    </tr>
                                    <tr class="table-warning">
                                        <td><strong>Gastos (diarios)</strong></td>
                                        {% for i in range(7) %}
                                        <td>Bs {{ totales.gastos|round(2) if totales.gastos else 0|round(2) }}</td>
                                        {% endfor %}
                                    </tr>
                                    <tr class="table-info">
                                        <td><strong>Utilidad Bruta</strong></td>
                                        {% set dias = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado',
                                        'domingo'] %}
                                        {% for dia in dias %}
                                        {% set ingreso = ingresos_dias[dia] if ingresos_dias and ingresos_dias[dia] is
                                        defined else 0 %}
                                        {% set venta = ventas_dias[dia] if ventas_dias and ventas_dias[dia] is defined
                                        else 0 %}
                                        {% set costos_diarios = (totales.costos_generales if totales.costos_generales
                                        else 0) * venta %}
                                        {% set gastos_diarios = totales.gastos if totales.gastos else 0 %}
                                        <td>Bs {{ (ingreso - costos_diarios - gastos_diarios)|round(2) }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-3 text-center">
                            <button type="submit" class="btn btn-primary btn-lg">
                                üìä Calcular Ventas por D√≠a
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ========== FLUJO POR SEMANAS ========== -->
        <div id="flujo_semanas_container" class="flujo-container" style="display: none;">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">üìÖ Flujo por Semanas</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('guardar_ventas_semanas') }}">
                        <div class="table-responsive">
                            <table class="table table-bordered text-center">
                                <thead class="table-light">
                                    <tr>
                                        <th>flujo por semanas</th>
                                        <th>semana 1</th>
                                        <th>semana 2</th>
                                        <th>semana 3</th>
                                        <th>semana 4</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="table-secondary"><strong>Nro de productos vendidos</strong></td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="semana1"
                                                value="{{ ventas_semanas.semana1 if ventas_semanas else 20 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="semana2"
                                                value="{{ ventas_semanas.semana2 if ventas_semanas else 14 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="semana3"
                                                value="{{ ventas_semanas.semana3 if ventas_semanas else 15 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="semana4"
                                                value="{{ ventas_semanas.semana4 if ventas_semanas else 12 }}" min="0">
                                        </td>
                                    </tr>

                                    <!-- C√°lculos autom√°ticos -->
                                    {% if ventas_semanas %}
                                    <tr class="table-success">
                                        <td><strong>Ingresos</strong></td>
                                        <td>Bs {{ (ventas_semanas.semana1 * proyecto.precio_producto)|round(2) }}</td>
                                        <td>Bs {{ (ventas_semanas.semana2 * proyecto.precio_producto)|round(2) }}</td>
                                        <td>Bs {{ (ventas_semanas.semana3 * proyecto.precio_producto)|round(2) }}</td>
                                        <td>Bs {{ (ventas_semanas.semana4 * proyecto.precio_producto)|round(2) }}</td>
                                    </tr>

                                    <tr class="table-danger">
                                        <td><strong>Costos (semanales)</strong></td>
                                        <td>Bs {{ (ventas_semanas.semana1 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_semanas.semana2 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_semanas.semana3 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_semanas.semana4 * totales.costos_generales)|round(2) }}</td>

                                    <tr class="table-warning">
                                        <td><strong>Gastos (semanales)</strong></td>
                                        {% for i in range(4) %}
                                        <td>Bs {{ (totales.gastos * 7)|round(2) }}</td>
                                        {% endfor %}
                                    </tr>

                                    <tr class="table-info">
                                        <td><strong>utilidad bruta</strong></td>
                                        {% set semanas = ['semana1', 'semana2', 'semana3', 'semana4'] %}
                                        {% for semana in semanas %}
                                        {% set ventas = ventas_semanas[semana] if ventas_semanas and
                                        ventas_semanas[semana] is defined else 0 %}
                                        {% set ingresos = ventas * proyecto.precio_producto %}
                                        {% set costos_semanales = totales.costos_generales * ventas %}
                                        {% set gastos_semanales = totales.gastos * 7 %}
                                        <td>Bs {{ (ingresos - costos_semanales - gastos_semanales)|round(2) }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-3 text-center">
                            <button type="submit" class="btn btn-success btn-lg">
                                üìä Calcular Ventas por Semana
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ========== FLUJO POR MESES ========== -->
        <div id="flujo_meses_container" class="flujo-container" style="display: none;">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">üìÖ Flujo por Meses (Enero - Julio)</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('guardar_ventas_meses') }}">
                        <div class="table-responsive">
                            <table class="table table-bordered text-center">
                                <thead class="table-light">
                                    <tr>
                                        <th>flujo por meses</th>
                                        <th>enero</th>
                                        <th>febrero</th>
                                        <th>marzo</th>
                                        <th>abril</th>
                                        <th>mayo</th>
                                        <th>junio</th>
                                        <th>julio</th>
                                        <th class="table-info">
                                            <small>Rango Enero-Julio</small>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="table-secondary"><strong>Nro de productos vendidos</strong></td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="enero"
                                                value="{{ ventas_meses.enero if ventas_meses else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="febrero"
                                                value="{{ ventas_meses.febrero if ventas_meses else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="marzo"
                                                value="{{ ventas_meses.marzo if ventas_meses else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="abril"
                                                value="{{ ventas_meses.abril if ventas_meses else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="mayo"
                                                value="{{ ventas_meses.mayo if ventas_meses else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="junio"
                                                value="{{ ventas_meses.junio if ventas_meses else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="julio"
                                                value="{{ ventas_meses.julio if ventas_meses else 0 }}" min="0">
                                        </td>

                                    </tr>

                                    <!-- calculos automaticos -->
                                    {% if ventas_meses %}
                                    <tr class="table-success">
                                        <td><strong>Ingresos</strong></td>
                                        <td>Bs {{ (ventas_meses.enero * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_meses.febrero * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_meses.marzo * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_meses.abril * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_meses.mayo * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_meses.junio * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_meses.julio * proyecto.precio_producto)|round(2)}}</td>
                                    </tr>
                                    <tr class="table-danger">
                                        <td><strong>Costos (mensuales)</strong></td>
                                        <td>Bs {{ (ventas_meses.enero * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_meses.febrero * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_meses.marzo * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_meses.abril * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_meses.mayo * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_meses.junio * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_meses.julio * totales.costos_generales)|round(2) }}</td>
                                    </tr>
                                    <tr class="table-warning">
                                        <td><strong>Gastos (mensuales)</strong></td>
                                        {% for i in range(7) %}
                                        <td>Bs {{ (totales.gastos * 30)|round(2) }}</td>
                                        {% endfor %}
                                    </tr>
                                    <tr class="table-info">
                                        <td><strong>Utilidad Bruta</strong></td>
                                        {% set meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio']
                                        %}
                                        {% for mes in meses %}
                                        {% set ventas = ventas_meses[mes] if ventas_meses and ventas_meses[mes] is
                                        defined else 0 %}
                                        {% set ingresos = ventas * proyecto.precio_producto %}
                                        {% set costos_mensuales = totales.costos_generales * ventas %}
                                        {% set gastos_mensuales = totales.gastos * 30 %}
                                        <td>Bs {{ (ingresos - costos_mensuales - gastos_mensuales)|round(2) }}</td>
                                        {% endfor %}
                                    </tr>

                                    {% endif %}
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-3 text-center">
                            <button type="submit" class="btn btn-warning btn-lg">
                                üìä Calcular Ventas por Mes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ========== FLUJO POR A√ëOS ========== -->
        <div id="flujo_anos_container" class="flujo-container" style="display: none;">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">üìÖ Flujo por A√±os</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('guardar_ventas_anos') }}">
                        <div class="table-responsive">
                            <table class="table table-bordered text-center">
                                <thead class="table-light">
                                    <tr>
                                        <th>flujo por a√±os</th>
                                        <th>a√±o 1</th>
                                        <th>a√±o 2</th>
                                        <th>a√±o 3</th>
                                        <th>a√±o 4</th>
                                        <th>a√±o 5</th>
                                        <th>a√±o 6</th>
                                        <th>a√±o 7</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="table-secondary"><strong>Nro de productos vendidos</strong></td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="a√±o1"
                                                value="{{ ventas_anos.a√±o1 if ventas_anos else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="a√±o2"
                                                value="{{ ventas_anos.a√±o2 if ventas_anos else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="a√±o3"
                                                value="{{ ventas_anos.a√±o3 if ventas_anos else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="a√±o4"
                                                value="{{ ventas_anos.a√±o4 if ventas_anos else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="a√±o5"
                                                value="{{ ventas_anos.a√±o5 if ventas_anos else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="a√±o6"
                                                value="{{ ventas_anos.a√±o6 if ventas_anos else 0 }}" min="0">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control text-center" name="a√±o7"
                                                value="{{ ventas_anos.a√±o7 if ventas_anos else 0 }}" min="0">
                                        </td>
                                    </tr>

                                    <!-- calculos automaticos -->
                                    {% if ventas_anos %}
                                    <tr class="table-success">
                                        <td><strong>Ingresos</strong></td>
                                        <td>Bs {{ (ventas_anos.a√±o1 * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_anos.a√±o2 * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_anos.a√±o3 * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_anos.a√±o4 * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_anos.a√±o5 * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_anos.a√±o6 * proyecto.precio_producto)|round(2)}}</td>
                                        <td>Bs {{ (ventas_anos.a√±o7 * proyecto.precio_producto)|round(2)}}</td>
                                    </tr>
                                    <tr class="table-danger">
                                        <td><strong>Costos (anuales)</strong></td>
                                        <td>Bs {{ (ventas_anos.a√±o1 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_anos.a√±o2 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_anos.a√±o3 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_anos.a√±o4 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_anos.a√±o5 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_anos.a√±o6 * totales.costos_generales)|round(2) }}</td>
                                        <td>Bs {{ (ventas_anos.a√±o7 * totales.costos_generales)|round(2) }}</td>
                                    </tr>
                                    <tr class="table-warning">
                                        <td><strong>Gastos (anuales)</strong></td>
                                        {% for i in range(7) %}
                                        <td>Bs {{ (totales.gastos * 365)|round(2) }}</td>
                                        {% endfor %}
                                    </tr>
                                    <tr class="table-info">
                                        <td><strong>Utilidad Bruta</strong></td>
                                        {% set a√±os = ['a√±o1', 'a√±o2', 'a√±o3', 'a√±o4', 'a√±o5', 'a√±o6', 'a√±o7'] %}
                                        {% for a√±o in a√±os %}
                                        {% set ventas = ventas_anos[a√±o] if ventas_anos and ventas_anos[a√±o] is defined
                                        else 0 %}
                                        {% set ingresos = ventas * proyecto.precio_producto %}
                                        {% set costos_anuales = totales.costos_generales * ventas %}
                                        {% set gastos_anuales = totales.gastos * 360 %}
                                        <td>Bs {{ (ingresos - costos_anuales - gastos_anuales)|round(2) }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-3 text-center">
                            <button type="submit" class="btn btn-info btn-lg">
                                üìä Calcular Ventas por A√±o
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Botones de navegaci√≥n -->
        <div class="d-flex justify-content-between mt-4">
            <div>
                <a href="{{ url_for('equipo_maquinaria') }}" class="btn btn-outline-secondary">
                    ‚Üê Volver a materiales y flujos
                </a>
            </div>
            <div class="d-flex gap-2">
                <a href="{{ url_for('calculos_financieros') }}" class="btn btn-primary">
                    Ver m√°s c√°lculos
                </a>
                <a href="{{ url_for('calculos_financieros') }}" class="btn btn-success">
                    Siguiente: Resultados Financieros ‚Üí
                </a>
            </div>
        </div>

        {% endif %} <!-- Fin del if proyecto -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
    .bg-purple {
        background-color: #6f42c1 !important;
    }

    .flujo-container {
        transition: all 0.3s ease;
    }

    .form-control.text-center {
        text-align: center;
    }

    /* Colores de tablas como en Excel */
    .table-success {
        background-color: #d1e7dd !important;
    }

    .table-danger {
        background-color: #f8d7da !important;
    }

    .table-warning {
        background-color: #fff3cd !important;
    }

    .table-info {
        background-color: #cff4fc !important;
    }
</style>

<script>
    // Funci√≥n para mostrar/ocultar flujos seg√∫n selecci√≥n
    function mostrarFlujo(tipo) {
        // Ocultar todos los contenedores
        document.querySelectorAll('.flujo-container').forEach(container => {
            container.style.display = 'none';
        });

        // Mostrar el contenedor seleccionado
        document.getElementById('flujo_' + tipo + '_container').style.display = 'block';

        // Guardar selecci√≥n en localStorage
        localStorage.setItem('tipo_flujo_seleccionado', tipo);

        // Actualizar URL sin recargar la p√°gina
        const url = new URL(window.location);
        url.searchParams.set('tipo', tipo);
        window.history.replaceState({}, '', url);
    }

    // Cargar selecci√≥n guardada al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', function () {
        // Verificar si hay tipo en URL
        const urlParams = new URLSearchParams(window.location.search);
        const tipoURL = urlParams.get('tipo');

        // Verificar localStorage
        const tipoGuardado = localStorage.getItem('tipo_flujo_seleccionado');

        // Determinar qu√© tipo mostrar
        let tipoAMostrar = 'dias'; // Por defecto

        if (tipoURL) {
            tipoAMostrar = tipoURL;
        } else if (tipoGuardado) {
            tipoAMostrar = tipoGuardado;
        }

        // Marcar el radio button correspondiente
        const radioBtn = document.getElementById('flujo_' + tipoAMostrar);
        if (radioBtn) {
            radioBtn.checked = true;
        }

        // Mostrar el flujo correspondiente
        mostrarFlujo(tipoAMostrar);
    });
</script>
{% endblock %}